@model Orcamentos.Models.Orcamento

@{
	ViewData["Title"] = "Editar";
}

<h1>Editar</h1>

<h4>Orçamento</h4>
<hr />
<div>
		<form asp-action="Edit" class="needs-validation">
			<div asp-validation-summary="ModelOnly" class="text-danger"></div>
			<div class="row">
				<div class="col-4">
					<input type="hidden" asp-for="Id" />
					<div class="form-group mb-2">
						<label class="control-label">Orçamento Nome</label>
						<div class="input-group">
							<select class="form-select" asp-for="orcamentoNomeId" required
									asp-items="@(new SelectList(ViewBag.orcamentosNomesList,"Value","Text"))">
								<option selected disabled value="">Selecione uma opção</option>
							</select>

						</div>
					</div>
					<div class="form-group mb-2">
						<label class="control-label">Perfil</label>
						<div class="input-group">
							<select class="form-select" asp-for="profileId" required
									asp-items="@(new SelectList(ViewBag.profilesList,"Value","Text"))">
								<option selected disabled value="">Selecione uma opção</option>
							</select>

						</div>

						<span asp-validation-for="profileId" class="text-danger"></span>
					</div>
					<div class="form-group mb-2">
						<label class="control-label">Tipo de Rendimento</label>
						<div class="input-group">
							<select class="form-select" asp-for="revenueTypeId" required
									asp-items="@(new SelectList(ViewBag.revenueTypesList,"Value","Text"))">
								<option selected disabled value="">Selecione uma opção</option>
							</select>

						</div>

						<span asp-validation-for="revenueTypeId" class="text-danger"></span>
					</div>
					<div class="form-group mb-2">
						<label class="control-label">Unidade de Negocio</label>
						<div class="input-group">
							<select class="form-select" asp-for="businessUnitId" required
									asp-items="@(new SelectList(ViewBag.businessUnitsList,"Value","Text"))">
								<option selected disabled value="">Selecione uma opção</option>
							</select>

						</div>

						<span asp-validation-for="businessUnitId" class="text-danger"></span>
					</div>
					<div class="form-group mb-2">
						<label asp-for="Marca" class="control-label"></label>
						<input asp-for="Marca" class="form-control" required/>
					</div>
					<div class="form-group mb-2">
						<label asp-for="TipoUni" class="control-label">Tipo de Unidade</label>
						<input asp-for="TipoUni" class="form-control" required/>
					</div>
					<div class="form-group mb-2">
						<label asp-for="Partnumb" class="control-label">Part Number</label>
						<input asp-for="Partnumb" class="form-control" required/>
					</div>
					<div class="form-group mb-2">
						<label asp-for="modelo" class="control-label">Modelo</label>
						<input asp-for="modelo" class="form-control" required/>
					</div>
					<div class="form-group mb-2">
						<label asp-for="SerialNumb" class="control-label">Numero de Serie</label>
						<input asp-for="SerialNumb" class="form-control" required/>
					</div>
					<div class="form-group mb-2">
						<label asp-for="ProductName" class="control-label">Nome do Produto</label>
						<input asp-for="ProductName" class="form-control" required/>
					</div>
				<div class="form-group mb-2">
					<label asp-for="Quantidade" class="control-label">Quantidade</label>
					<input asp-for="Quantidade" class="form-control" id="qnt" required/>
				</div>
					<div class="mb-2">
						<label asp-for="UnitPrice" class="control-label">Preço de Unidade Diário</label>
						<div class="input-group">
							<input asp-for="UnitPrice" class="form-control" id="unitPrice" required/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>	
					</div>
				</div>
				<div class="col-4">
				<div class="mb-2">
					<label asp-for="UnitCost" class="control-label">Custo de Unidade Diário</label>
					<div class="input-group">
						<input asp-for="UnitCost" class="form-control" id="unitCost" required/>
						<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
						</div>
					</div>
				</div>
					<div class="mb-2">
						<label asp-for="DescontoTabela" class="control-label">Desconto da Tabela</label>
						<div class="input-group">
							<input asp-for="DescontoTabela" class="form-control" id="descTabela" required/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>
					</div>
					<div class="mb-2">
						<label asp-for="PrecoParcial" class="control-label">Preço Parcial</label>
						<div class="input-group">
							<input asp-for="PrecoParcial" class="form-control" id="precoParcial" required/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>	
					</div>
					<div class="mb-2">
						<label asp-for="CustoTabela" class="control-label">Custo da Tabela</label>
						<div class="input-group">
							<input asp-for="CustoTabela" class="form-control" id="custoTabela" required/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>
					</div>
					<div class="mb-2">
						<label asp-for="CustoDesc1" class="control-label">Custo do Desconto 1</label>
						<div class="input-group">
							<input asp-for="CustoDesc1" class="form-control" id="custoDesc1" required/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>	
					</div>
					<div class="mb-2">
						<label asp-for="CustoDesc2" class="control-label">Custo do Desconto 2</label>
						<div class="input-group">
							<input asp-for="CustoDesc2" class="form-control" id="custoDesc2" required/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>			
					</div>
					<div class="mb-2">
						<label asp-for="CustoDesc3" class="control-label">Custo do Desconto 3</label>
						<div class="input-group">
							<input asp-for="CustoDesc3" class="form-control" id="custoDesc3" required/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>	
					</div>
					<div class="mb-2">
						<label asp-for="TotalCost" class="control-label">Custo Total</label>
						<div class="input-group">
							<input asp-for="TotalCost" class="form-control" id="custoTotal" readonly/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>
						
					</div>
					<div class="mb-2">
						<label asp-for="TotalPrice" class="control-label">Preço Total</label>
						<div class="input-group">
							<input asp-for="TotalPrice" class="form-control" id="precoTotal" readonly/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>
					</div>
					<div class="mb-2">
						<label asp-for="Margin" class="control-label">Margem</label>
						<div class="input-group">
							<input asp-for="Margin" class="form-control" id="margem" readonly/>
							<div class="input-group-append">
								<span class="input-group-text">,00 €</span>
							</div>
						</div>
					</div>
					<div class="mb-2">
						<label asp-for="MG" class="control-label">MG</label>
						<div class="input-group">
							<input asp-for="MG" class="form-control" id="MG" readonly/>
							<div class="input-group-append">
								<span class="input-group-text">%</span>
							</div>
						</div>
						
					</div>
					<div class="form-group form-check">
						<label class="form-check-label">
							<input class="form-check-input" asp-for="Ativo" /> @Html.DisplayNameFor(model => model.Ativo)
						</label>
					</div>
					<div class="form-group">
						<input type="submit" value="Guardar" class="btn btn-primary" />
					</div>
				</div>
			</div>
		</form>

	<div>
		<a class="btn btn-primary" asp-action="Index">Voltar para a lista</a>
	</div>
</div>

<script>

	 var qnt = document.getElementById("qnt");
    var unitPrice = document.getElementById("unitPrice");
    var unitCost = document.getElementById("unitCost");
    var descTabela = document.getElementById("descTabela");
    var precoParcial = document.getElementById("precoParcial");
    var custoTabela = document.getElementById("custoTabela");
    var custoDesc1 = document.getElementById("custoDesc1");
    var custoDesc2 = document.getElementById("custoDesc2");
    var custoDesc3 = document.getElementById("custoDesc3");

    var custoTotal = document.getElementById("custoTotal");
    var precoTotal = document.getElementById("precoTotal");
    var margem = document.getElementById("margem");
    var MG = document.getElementById("MG");

    qnt.addEventListener("keyup", cost);
    unitCost.addEventListener("keyup", cost);
    unitPrice.addEventListener("keyup", price);
    custoDesc1.addEventListener("keyup", price);
    custoDesc2.addEventListener("keyup", price);
    custoDesc3.addEventListener("keyup", price);
    descTabela.addEventListener("keyup", price);
    precoParcial.addEventListener("keyup", price);

    function cost(){
        if(unitCost.value != ""){
            var q = qnt.value;

            if(q == ""){
                q = 1;
            }

            custoTotal.value = parseInt(q) * unitCost.value;
        }

        if(custoTotal.value != "" && precoTotal.value != ""){
            margem.value = precoTotal.value - custoTotal.value;
            MG.value = margem.value / precoTotal.value
        }
    }

    function price(){
        if(unitPrice.value != ""){
            var desc1 = custoDesc1.value;
            var desc2 = custoDesc2.value;
            var desc3 = custoDesc3.value;
            var precoP = precoParcial.value;
            var descT = descTabela.value;

            if(desc1 == ""){
                desc1 = 0;
            }

            if(desc2 == ""){
                desc2 = 0;
            }

            if(desc3 == ""){
                desc3 = 0;
            }

            if(precoP == ""){
                precoP = 0;
            }

            if(descT == ""){
                descT = 0;
            }

            var descs = parseInt(desc1) + parseInt(desc2) + parseInt(desc3);

            precoTotal.value = ((unitPrice.value - parseInt(descT)) + parseInt(precoP)) - descs;

            if(custoTotal.value != "" && precoTotal.value != ""){
                margem.value = precoTotal.value - custoTotal.value;
                MG.value = margem.value / precoTotal.value
            }
        }
    }

    (function() {
  'use strict';
  window.addEventListener('load', function() {
    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.getElementsByClassName('needs-validation');
    // Loop over them and prevent submission
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

    

</script>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
	}
